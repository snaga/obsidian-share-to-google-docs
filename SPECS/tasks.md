### 💖 Share to Google Docs 開発タスクリスト ver. ギャル 💖

---

うちらが最強のプラグインをリリースするまでの道のりをタスクにしてみたよ！
これを一個ずつクリアしていけば、絶対うまくいくっしょ！いっちょやりますか！💪✨

---

### 💖 開発の基本コマンド 💖

開発を始める前に、これだけは覚えとこ！

*   **依存関係のインストール**: `npm install`
    *   最初にこれを実行して、開発に必要なライブラリを全部インストール！
*   **ビルド**: `npm run build`
    *   コードを書き換えたら、これを実行！Obsidianが読み込むための`main.js`ファイルが作られるよ。

---

#### Milestone 1: まずは土台作りと鬼大事な認証から！ (完了済)

プラグインの骨格を作って、最重要ミッションのGoogleアカウント連携を終わらせちゃお！

-   [x] **環境構築**
    -   [x] `googleapis` っていうGoogle APIを使いやすくするライブラリを`npm`で入れる。
    -   [x] ローカルサーバーで使う`http`っていうライブラリの型定義 (`@types/node`) も入れとく。
    -   [x] ビルド設定（`esbuild.config.mjs`）を修正して、Node.jsのモジュールがちゃんと解決できるようにする。
-   [x] **ファイル構成の整備**
    -   [x] ソースコードを管理する`src`フォルダを作成する。
    -   [x] `main.ts`を`src`フォルダに移動し、ビルド設定を更新する。
    -   [x] `types.ts`, `settings.ts`, `auth.ts`, `googleApiClient.ts`, `obsidianHelper.ts` のファイルを作成する。
-   [x] **データモデル定義 (`types.ts`)**
    -   [x] `PluginSettings` と `GoogleAuthTokens` の型をTypeScriptのインターフェースで作っとく。
-   [x] **Obsidianヘルパー (`obsidianHelper.ts`) の実装**
    -   [x] 今開いてるファイルの中身とタイトルをGETする関数を実装する。
-   [x] **Google OAuthハンドラー (`auth.ts`) の実装 (`googleapis`版)**
    -   [x] Googleの認証画面に飛ぶためのURLを生成するロジックを実装！
    -   [x] 認証が終わった連絡を受け取るためのローカルサーバーを立てたり閉じたりする処理を実装！
    -   [x] 認証コードをアクセストークンとリフレッシュトークンに交換して、ちゃんと保存する処理を実装！
    -   [x] アクセストークンが古くなったら、裏でこっそり新しいのをGETし直す処理も実装！
-   [x] **設定画面 (`settings.ts`) の実装**
    -   [x] プラグインの設定画面で、GoogleのClient IDとClient Secretを入力できるようにする。
    -   [x] アカウント連携してるかしてないか見えるようにする。
    -   [x] 「Googleアカウントと連携」「連携解除」ボタンを実装する。

---

#### Milestone 2: メイン機能！ファイルエクスポートいくぞ！ (完了済)

認証ができたら、いよいよメインディッシュのMarkdownエクスポート機能を実装するよ！

-   [x] **Google APIクライアント (`googleApiClient.ts`) の実装 (`googleapis`版)**
    -   [x] アクセストークンを使って、Google Drive APIにリクエストを送るための基本の仕組みを実装する。
    -   [x] Markdownのテキストを、Google Driveに`.md`ファイルとしてアップロードする関数を実装！
    -   [x] Driveにある`.md`ファイルを、Googleドキュメントに華麗に変換コピーする関数を実装！
    -   [x] 用済みになった`.md`ファイルをゴミ箱に移動させる処理を実装！
-   [x] **メイン機能の統合 (`main.ts`)**
    -   [x] リボンにエクスポート用のイケてるアイコンを追加する。
    -   [x] コマンドパレットにも「Google Docsへエクスポート」コマンドを追加！
    -   [x] アイコンをポチるかコマンドを実行したら、エクスポート処理が動くように、全体の流れを実装する。
-   [x] **UIの仕上げ**
    -   [x] エクスポート中は「エクスポート中...🚀」って通知を出し、終わったら結果を同じ通知で表示するように改善！
    -   [x] トークン更新時など、裏方の処理で余計な通知が出ないように修正！

---

#### Milestone 3: `googleapis`から卒業！`fetch`でキメるぜ！ (完了済)

`googleapis`ライブラリをアンインストールして、Obsidian標準の`fetch` APIでGoogle APIを直接叩くように大改造！

-   [x] **`googleapis`のアンインストール**
    -   [x] `npm uninstall googleapis` を実行して、プロジェクトからライブラリを削除。
-   [x] **Google OAuthハンドラー (`auth.ts`) の`fetch`化**
    -   [x] `fetch`でGoogleのトークンエンドポイントにリクエストを送る処理を実装。
    -   [x] 認証コードをアクセストークンに交換する処理を`fetch`版に書き換え。
    -   [x] リフレッシュトークンでアクセストークンを更新する処理を`fetch`版に書き換え。
-   [x] **Google APIクライアント (`googleApiClient.ts`) の`fetch`化**
    -   [x] `fetch`でGoogle Drive APIに`multipart/related`形式のリクエストを送る処理を実装。
    -   [x] Markdownから直接Google Docsに変換・アップロードするロジックに一本化。
-   [x] **型定義の見直し (`types.ts`)**
    -   [x] `googleapis`に依存していた型定義を自前のものに修正。
-   [x] **動作確認**
    -   [x] 新しい`fetch`ベースのコードで、認証とエクスポートが正常に動作することを確認。

---

#### Milestone 4: 最終仕上げ！コードもドキュメントもピカピカに！ (完了済)

最後に、コードをキレイにして、みんなが使えるようにドキュメントを整えたらマジ完璧！

-   [x] **UIの改善**
    -   [x] プラグインの名前を「Share to Google Docs」に、IDを`share-to-google-docs`に変更 (`manifest.json`)。
    -   [x] 設定画面のタイトルを「Share to Google Docs の設定」に変更 (`settings.ts`)。
    -   [x] 設定画面のClient IDとSecretの入力欄をパスワード形式にして、入力内容が見えないようにする。
-   [x] **コードのリファクタリング**
    -   [x] `googleApiClient.ts` のエラーハンドリングを改善し、APIからのエラーメッセージをユーザーに通知するようにした。
    -   [x] `auth.ts` のURLやスコープなどのマジックナンバーを定数に切り出した。
    -   [x] `main.ts` のエクスポート処理を`startExport`メソッドに切り出し、コマンド名などをアプリ名に合わせて更新した。
-   [x] **ドキュメントの更新**
    -   [x] `requirements.md`, `design.md`, `tasks.md` に全ての変更点を反映させた。
    -   [x] `README.md` を全面的に書き直し、ギャル語のイケてる使い方ガイドにした。
-   [ ] **リリースノートの準備** (これはリリース直前にやる！)

---
### 🚀 将来の拡張タスク 🚀

---

#### Milestone X: 認証サーバー導入で神プラグインへ！

ユーザー体験を神にするための、未来のタスク！

-   [ ] **認証用中継サーバーの技術選定**: どこでサーバー動かすか決める (Vercel? Netlify? Fly.io?)
-   [ ] **サーバーサイドの認証フローを実装する**: うちらのID/Secretを使ってGoogleと話すサーバー側のプログラムを作る。
-   [ ] **プラグイン側の認証フローを修正する**: PC内で完結する今のやり方から、うちらのサーバーと通信するやり方に変更する。
-   [ ] **Googleのアプリ審査を申請する**: うちらのプラグインが安全だってことをGoogleに認めてもらう。